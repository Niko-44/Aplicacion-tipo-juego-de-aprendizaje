<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administración - Misiones y Logros</title>
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2c3e50;
      --success-color: #2ecc71;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --light-color: #ecf0f1;
      --dark-color: #34495e;
      --border-radius: 6px;
      --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 20px;
    }
    
    h1, h2, h3 {
      color: var(--secondary-color);
      margin-top: 0;
    }
    
    h1 {
      border-bottom: 2px solid var(--light-color);
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    
    h2 {
      font-size: 1.4rem;
      margin-bottom: 15px;
    }
    
    /* Estilos para formularios */
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: var(--dark-color);
    }
    
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: inherit;
      font-size: 14px;
      transition: var(--transition);
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    /* Estilos para botones */
    .btn {
      display: inline-block;
      padding: 10px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      transition: var(--transition);
      margin-right: 8px;
      margin-bottom: 8px;
    }
    
    .btn:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-success:hover {
      background-color: #27ae60;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-danger:hover {
      background-color: #c0392b;
    }
    
    .btn-warning {
      background-color: var(--warning-color);
    }
    
    .btn-warning:hover {
      background-color: #d35400;
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
    }
    
    .btn-secondary:hover {
      background-color: #1a252f;
    }
    
    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    /* Estilos para tablas */
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: var(--light-color);
      font-weight: 600;
      color: var(--dark-color);
    }
    
    tr:hover {
      background-color: rgba(236, 240, 241, 0.5);
    }
    
    /* Estilos para mensajes */
    .message {
      padding: 10px 15px;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
    }
    
    .message-success {
      background-color: rgba(46, 204, 113, 0.1);
      color: #27ae60;
      border-left: 4px solid var(--success-color);
    }
    
    .message-error {
      background-color: rgba(231, 76, 60, 0.1);
      color: #c0392b;
      border-left: 4px solid var(--danger-color);
    }
    
    /* Estilos para login */
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-header h1 {
      border-bottom: none;
      margin-bottom: 10px;
    }
    
    /* Estilos para panel de administración */
    #adminPanel {
      display: none;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .section-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, #ddd, transparent);
      margin: 30px 0;
    }
    
    /* Estilos para formularios de edición */
    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Estilos para gestión de pasos */
    .pasos-container {
      margin-bottom: 15px;
    }
    
    .paso-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      background-color: #f9f9f9;
      border-radius: var(--border-radius);
    }
    
    .paso-texto {
      flex-grow: 1;
      margin-right: 10px;
    }
    
    .paso-eliminar {
      background: none;
      border: none;
      color: var(--danger-color);
      cursor: pointer;
      font-size: 16px;
    }
    
    .agregar-paso-container {
      display: flex;
      gap: 10px;
    }
    
    .agregar-paso-input {
      flex-grow: 1;
    }
    
    /* Badges para niveles y tipos */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-facil {
      background-color: rgba(46, 204, 113, 0.2);
      color: #27ae60;
    }
    
    .badge-intermedio {
      background-color: rgba(243, 156, 18, 0.2);
      color: #d35400;
    }
    
    .badge-dificil {
      background-color: rgba(231, 76, 60, 0.2);
      color: #c0392b;
    }
    
    .badge-diaria {
      background-color: rgba(52, 152, 219, 0.2);
      color: #2980b9;
    }
    
    .badge-semanal {
      background-color: rgba(155, 89, 182, 0.2);
      color: #8e44ad;
    }
    
    .badge-mensual {
      background-color: rgba(241, 196, 15, 0.2);
      color: #f39c12;
    }
    
    .badge-especial {
      background-color: rgba(230, 126, 34, 0.2);
      color: #e67e22;
    }
    
    /* Estilos para estado de carga */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        margin-right: 0;
      }
      
      .agregar-paso-container {
        flex-direction: column;
      }
      
      .form-row {
        flex-direction: column;
      }
    }
    
    /* Estilos para filas de formulario */
    .form-row {
      display: flex;
      gap: 15px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
  </style>
</head>
<body>
  <!-- FORMULARIO DE LOGIN -->
  <div id="loginForm">
    <div class="container">
      <div class="card login-container">
        <div class="login-header">
          <h1>Panel de Administración</h1>
          <p>Ingresa tus credenciales para continuar</p>
        </div>
        <div class="form-group">
          <label for="username">Usuario:</label>
          <input type="text" id="username" placeholder="Ingresa tu usuario">
        </div>
        <div class="form-group">
          <label for="password">Contraseña:</label>
          <input type="password" id="password" placeholder="Ingresa tu contraseña">
        </div>
        <button class="btn btn-success" onclick="login()" style="width: 100%;">Ingresar</button>
        <div id="loginError" class="message message-error" style="display: none;"></div>
      </div>
    </div>
  </div>

  <!-- PANEL DE ADMINISTRACIÓN -->
  <div id="adminPanel">
    <div class="container">
      <div class="admin-header">
        <h1>Panel de Administración</h1>
        <button class="btn btn-secondary" onclick="logout()">Cerrar Sesión</button>
      </div>

      <!-- CAMBIO DE USUARIO / CONTRASEÑA -->
      <div class="card">
        <h2>Configuración de Cuenta</h2>
        <div class="form-group">
          <label for="newUser">Nuevo Usuario:</label>
          <input type="text" id="newUser" placeholder="Nuevo nombre de usuario">
        </div>
        <div class="form-group">
          <label for="newPass">Nueva Contraseña:</label>
          <input type="password" id="newPass" placeholder="Nueva contraseña">
        </div>
        <button class="btn btn-success" onclick="cambiarCredenciales()">Guardar Cambios</button>
        <div id="configMsg" class="message" style="display: none;"></div>
      </div>

      <!-- ADMINISTRACIÓN DE MISIONES -->
      <div class="card">
        <h2>Administración de Misiones</h2>
        
        <div class="form-container">
          <h3 id="form-title">Agregar Nueva Misión</h3>
          <input type="hidden" id="misionId">
          <div class="form-group">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" placeholder="Título de la misión">
          </div>
          <div class="form-group">
            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" rows="3" placeholder="Descripción de la misión"></textarea>
          </div>
          
          <div class="form-group">
            <label>Pasos de la misión:</label>
            <div class="pasos-container" id="pasosContainer">
              <!-- Los pasos se agregarán aquí dinámicamente -->
            </div>
            <div class="agregar-paso-container">
              <input type="text" id="nuevoPaso" class="agregar-paso-input" placeholder="Nuevo paso">
              <button class="btn btn-small" onclick="agregarPaso()">Agregar Paso</button>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="tipo">Tipo:</label>
              <select id="tipo">
                <option value="">Selecciona un tipo</option>
                <option value="diaria">Diaria</option>
                <option value="semanal">Semanal</option>
                <option value="mensual">Mensual</option>
                <option value="especial">Especial</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="nivel">Nivel:</label>
              <select id="nivel">
                <option value="">Selecciona un nivel</option>
                <option value="facil">Fácil</option>
                <option value="intermedio">Intermedio</option>
                <option value="dificil">Difícil</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="btn btn-success" onclick="guardarMision()">Guardar Misión</button>
            <button class="btn btn-secondary" onclick="resetFormMision()">Cancelar</button>
          </div>
        </div>

        <h3>Misiones Existentes</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Título</th>
                <th>Descripción</th>
                <th>Nivel</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="misionesTable">
              <tr>
                <td colspan="4" style="text-align: center;">Cargando misiones...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section-divider"></div>

      <!-- ADMINISTRACIÓN DE LOGROS -->
      <div class="card">
        <h2>Administración de Logros</h2>
        
        <div class="form-container">
          <h3 id="logro-form-title">Agregar Nuevo Logro</h3>
          <input type="hidden" id="logroId">
          <div class="form-group">
            <label for="logroNombre">Nombre:</label>
            <input type="text" id="logroNombre" placeholder="Nombre del logro">
          </div>
          <div class="form-group">
            <label for="logroDescripcion">Descripción:</label>
            <textarea id="logroDescripcion" rows="3" placeholder="Descripción del logro"></textarea>
          </div>
          <div class="form-group">
            <label for="logroPuntos">Puntos requeridos:</label>
            <input type="number" id="logroPuntos" placeholder="Puntos necesarios" min="0">
          </div>
          <div class="form-actions">
            <button class="btn btn-success" onclick="guardarLogro()">Guardar Logro</button>
            <button class="btn btn-secondary" onclick="resetFormLogro()">Cancelar</button>
          </div>
        </div>

        <h3>Logros Existentes</h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Puntos Requeridos</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="logrosTable">
              <tr>
                <td colspan="4" style="text-align: center;">Cargando logros...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

<script>
const MISIONES_API = "/misiones";
const LOGROS_API = "/logros";

// CREDENCIALES (guardadas en localStorage para mantener cambios)
let ADMIN_USER = localStorage.getItem("adminUser") || "admin";
let ADMIN_PASS = localStorage.getItem("adminPass") || "1234";

// Array para almacenar los pasos de la misión actual
let pasosActuales = [];

// ===========================
// LOGIN
// ===========================
function login() {
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;
  const error = document.getElementById("loginError");

  if(user === ADMIN_USER && pass === ADMIN_PASS) {
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    cargarMisiones();
    cargarLogros();
  } else {
    error.innerText = "Usuario o contraseña incorrectos.";
    error.style.display = "block";
  }
}

function logout() {
  document.getElementById("loginForm").style.display = "block";
  document.getElementById("adminPanel").style.display = "none";
  document.getElementById("username").value = "";
  document.getElementById("password").value = "";
  document.getElementById("loginError").style.display = "none";
}

// ===========================
// CAMBIAR USUARIO / CONTRASEÑA
// ===========================
function cambiarCredenciales() {
  const newUser = document.getElementById("newUser").value.trim();
  const newPass = document.getElementById("newPass").value.trim();
  const msg = document.getElementById("configMsg");

  if(newUser && newPass) {
    ADMIN_USER = newUser;
    ADMIN_PASS = newPass;
    localStorage.setItem("adminUser", ADMIN_USER);
    localStorage.setItem("adminPass", ADMIN_PASS);
    
    msg.innerText = "Usuario y contraseña actualizados con éxito.";
    msg.className = "message message-success";
    msg.style.display = "block";
    
    document.getElementById("newUser").value = "";
    document.getElementById("newPass").value = "";
    
    // Ocultar mensaje después de 3 segundos
    setTimeout(() => {
      msg.style.display = "none";
    }, 3000);
  } else {
    msg.innerText = "Ambos campos son obligatorios.";
    msg.className = "message message-error";
    msg.style.display = "block";
  }
}

// ===========================
// GESTIÓN DE PASOS
// ===========================
function agregarPaso() {
  const nuevoPasoInput = document.getElementById("nuevoPaso");
  const pasoTexto = nuevoPasoInput.value.trim();
  
  if (pasoTexto) {
    pasosActuales.push(pasoTexto);
    renderizarPasos();
    nuevoPasoInput.value = "";
    nuevoPasoInput.focus();
  }
}

function eliminarPaso(index) {
  pasosActuales.splice(index, 1);
  renderizarPasos();
}

function renderizarPasos() {
  const pasosContainer = document.getElementById("pasosContainer");
  pasosContainer.innerHTML = "";
  
  if (pasosActuales.length === 0) {
    pasosContainer.innerHTML = '<p style="color: #777; font-style: italic;">No hay pasos agregados</p>';
    return;
  }
  
  pasosActuales.forEach((paso, index) => {
    const pasoElement = document.createElement("div");
    pasoElement.className = "paso-item";
    pasoElement.innerHTML = `
      <span class="paso-texto">${index + 1}. ${paso}</span>
      <button class="paso-eliminar" onclick="eliminarPaso(${index})">×</button>
    `;
    pasosContainer.appendChild(pasoElement);
  });
}

// ===========================
// FUNCIONES MISIÓN
// ===========================
async function cargarMisiones() {
  try {
    const tbody = document.getElementById("misionesTable");
    tbody.innerHTML = "<tr><td colspan='4' style='text-align: center;'>Cargando misiones...</td></tr>";
    
    const res = await fetch(MISIONES_API);
    const misiones = await res.json();
    
    tbody.innerHTML = "";

    if (misiones.length === 0) {
      tbody.innerHTML = "<tr><td colspan='4' style='text-align: center;'>No hay misiones registradas</td></tr>";
      return;
    }

    misiones.forEach(m => {
      const pasosArray = Array.isArray(m.pasos) ? m.pasos : [];
      
      // Determinar la clase del badge según el nivel
      let nivelClass = "";
      let nivelTexto = "";
      switch(m.nivel) {
        case "facil":
          nivelClass = "badge-facil";
          nivelTexto = "Fácil";
          break;
        case "intermedio":
          nivelClass = "badge-intermedio";
          nivelTexto = "Intermedio";
          break;
        case "dificil":
          nivelClass = "badge-dificil";
          nivelTexto = "Difícil";
          break;
        default:
          nivelClass = "";
          nivelTexto = m.nivel || "";
      }
      
      // Determinar la clase del badge según el tipo
      let tipoClass = "";
      let tipoTexto = "";
      switch(m.tipo) {
        case "diaria":
          tipoClass = "badge-diaria";
          tipoTexto = "Diaria";
          break;
        case "semanal":
          tipoClass = "badge-semanal";
          tipoTexto = "Semanal";
          break;
        case "mensual":
          tipoClass = "badge-mensual";
          tipoTexto = "Mensual";
          break;
        case "especial":
          tipoClass = "badge-especial";
          tipoTexto = "Especial";
          break;
        default:
          tipoClass = "";
          tipoTexto = m.tipo || "";
      }
      
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${m.titulo || ""}</td>
        <td>${m.descripcion || ""}</td>
        
        <td><span class="badge ${nivelClass}">${nivelTexto}</span></td>
        <td>
          <button class='btn btn-small btn-warning' onclick='editarMision("${m._id}")'>Editar</button>
          <button class='btn btn-small btn-danger' onclick='eliminarMision("${m._id}")'>Eliminar</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) { 
    console.error("Error al cargar misiones:", err);
    document.getElementById("misionesTable").innerHTML = "<tr><td colspan='6' style='text-align: center; color: red;'>Error al cargar las misiones</td></tr>";
  }
}

async function guardarMision() {
  const id = document.getElementById("misionId").value;
  const data = {
    titulo: document.getElementById("titulo").value,
    descripcion: document.getElementById("descripcion").value,
    pasos: pasosActuales,
    tipo: document.getElementById("tipo").value,
    nivel: document.getElementById("nivel").value
  };
  
  // Validación básica
  if (!data.titulo.trim()) {
    alert("El título es obligatorio");
    return;
  }
  
  if (data.pasos.length === 0) {
    alert("Debe agregar al menos un paso");
    return;
  }
  
  if (!data.tipo) {
    alert("Debe seleccionar un tipo");
    return;
  }
  
  if (!data.nivel) {
    alert("Debe seleccionar un nivel");
    return;
  }
  
  try {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<span class="loading"></span> Guardando...';
    btn.disabled = true;
    
    if (id) {
      await fetch(`${MISIONES_API}/${id}`, { 
        method: "PUT", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify(data) 
      });
    } else {
      await fetch(MISIONES_API, { 
        method: "POST", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify(data) 
      });
    }
    
    resetFormMision();
    cargarMisiones();
    
    btn.innerHTML = originalText;
    btn.disabled = false;
  } catch (err) { 
    console.error(err);
    alert("Error al guardar la misión");
    event.target.innerHTML = originalText;
    event.target.disabled = false;
  }
}

async function editarMision(id) {
  try {
    const res = await fetch(`${MISIONES_API}/${id}`);
    const m = await res.json();
    document.getElementById("form-title").innerText = "Editar Misión";
    document.getElementById("misionId").value = m._id;
    document.getElementById("titulo").value = m.titulo || "";
    document.getElementById("descripcion").value = m.descripcion || "";
    document.getElementById("tipo").value = m.tipo || "";
    document.getElementById("nivel").value = m.nivel || "";
    
    // Cargar los pasos existentes
    pasosActuales = Array.isArray(m.pasos) ? m.pasos : [];
    renderizarPasos();
    
    // Desplazar hacia el formulario
    document.getElementById("form-title").scrollIntoView({ behavior: 'smooth' });
  } catch (err) { 
    console.error(err);
    alert("Error al cargar la misión para editar");
  }
}

async function eliminarMision(id) {
  if (!confirm("¿Seguro que quieres eliminar esta misión?")) return;
  
  try { 
    await fetch(`${MISIONES_API}/${id}`, { method: "DELETE" }); 
    cargarMisiones();
  }
  catch (err) { 
    console.error(err);
    alert("Error al eliminar la misión");
  }
}

function resetFormMision() {
  document.getElementById("form-title").innerText = "Agregar Nueva Misión";
  document.getElementById("misionId").value = "";
  document.getElementById("titulo").value = "";
  document.getElementById("descripcion").value = "";
  document.getElementById("tipo").value = "";
  document.getElementById("nivel").value = "";
  
  // Limpiar pasos
  pasosActuales = [];
  renderizarPasos();
}

// ===========================
// FUNCIONES LOGRO
// ===========================
async function cargarLogros() {
  try {
    const tbody = document.getElementById("logrosTable");
    tbody.innerHTML = "<tr><td colspan='4' style='text-align: center;'>Cargando logros...</td></tr>";
    
    const res = await fetch(LOGROS_API);
    const logros = await res.json();
    tbody.innerHTML = "";

    if (logros.length === 0) {
      tbody.innerHTML = "<tr><td colspan='4' style='text-align: center;'>No hay logros registrados</td></tr>";
      return;
    }

    logros.forEach(l => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${l.nombre || ""}</td>
        <td>${l.descripcion || ""}</td>
        <td>${l.puntos_requeridos || 0}</td>
        <td>
          <button class='btn btn-small btn-warning' onclick='editarLogro("${l._id}")'>Editar</button>
          <button class='btn btn-small btn-danger' onclick='eliminarLogro("${l._id}")'>Eliminar</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) { 
    console.error("Error al cargar logros:", err);
    document.getElementById("logrosTable").innerHTML = "<tr><td colspan='4' style='text-align: center; color: red;'>Error al cargar los logros</td></tr>";
  }
}

async function guardarLogro() {
  const id = document.getElementById("logroId").value;
  const data = {
    nombre: document.getElementById("logroNombre").value,
    descripcion: document.getElementById("logroDescripcion").value,
    puntos_requeridos: Number(document.getElementById("logroPuntos").value)
  };
  
  // Validación básica
  if (!data.nombre.trim()) {
    alert("El nombre es obligatorio");
    return;
  }
  
  if (data.puntos_requeridos < 0) {
    alert("Los puntos no pueden ser negativos");
    return;
  }
  
  try {
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<span class="loading"></span> Guardando...';
    btn.disabled = true;
    
    if (id) {
      await fetch(`${LOGROS_API}/${id}`, { 
        method: "PUT", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify(data) 
      });
    } else {
      await fetch(LOGROS_API, { 
        method: "POST", 
        headers: { "Content-Type": "application/json" }, 
        body: JSON.stringify(data) 
      });
    }
    
    resetFormLogro();
    cargarLogros();
    
    btn.innerHTML = originalText;
    btn.disabled = false;
  } catch (err) { 
    console.error(err);
    alert("Error al guardar el logro");
    event.target.innerHTML = originalText;
    event.target.disabled = false;
  }
}

async function editarLogro(id) {
  try {
    const res = await fetch(`${LOGROS_API}/${id}`);
    const l = await res.json();
    document.getElementById("logro-form-title").innerText = "Editar Logro";
    document.getElementById("logroId").value = l._id;
    document.getElementById("logroNombre").value = l.nombre || "";
    document.getElementById("logroDescripcion").value = l.descripcion || "";
    document.getElementById("logroPuntos").value = l.puntos_requeridos || 0;
    
    // Desplazar hacia el formulario
    document.getElementById("logro-form-title").scrollIntoView({ behavior: 'smooth' });
  } catch (err) { 
    console.error(err);
    alert("Error al cargar el logro para editar");
  }
}

async function eliminarLogro(id) {
  if (!confirm("¿Seguro que quieres eliminar este logro?")) return;
  
  try { 
    await fetch(`${LOGROS_API}/${id}`, { method: "DELETE" }); 
    cargarLogros();
  }
  catch (err) { 
    console.error(err);
    alert("Error al eliminar el logro");
  }
}

function resetFormLogro() {
  document.getElementById("logro-form-title").innerText = "Agregar Nuevo Logro";
  document.getElementById("logroId").value = "";
  document.getElementById("logroNombre").value = "";
  document.getElementById("logroDescripcion").value = "";
  document.getElementById("logroPuntos").value = "";
}

// Permitir enviar formularios con Enter
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('password').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      login();
    }
  });
  
  document.getElementById('nuevoPaso').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      agregarPaso();
    }
  });
});
</script>

</body>
</html>